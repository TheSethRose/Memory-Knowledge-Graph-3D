<!DOCTYPE html>
<html lang="en" data-theme="system">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Knowledge Graph 3D</title>

    <!-- Favicon -->
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <script type="module" src="/scripts/main.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Progress bar for loading large datasets -->
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <div>Loading 3D memory graph...</div>
            <div id="loading-status">Preparing data...</div>
        </div>

        <!-- Panel toggle button - moved before the panel -->
        <div class="panel-toggle" id="panel-toggle">
            <span class="panel-toggle-icon">‚ò∞</span>
        </div>

        <div class="panel" id="main-panel">
            <div class="panel-header">
                <h1>Memory Knowledge Graph 3D</h1>
                <div class="panel-close">√ó</div>
            </div>

            <div class="data-controls-section">
                <div class="tab-buttons">
                    <div class="tab-button active" id="file-tab">Load From File</div>
                    <div class="tab-button" id="json-tab">Paste JSON</div>
                </div>

                <div id="file-tab-content" style="display: block;">
                    <input type="file" id="file-input" accept=".json,.jsonl">
                </div>

                <div id="json-tab-content">
                    <textarea id="data-input" placeholder="Paste your JSON data here..."></textarea>
                    <button id="parse-json">Load Data</button>
                </div>
            </div>

            <div class="search-section">
                <input type="text" id="search" placeholder="Search entities..." />
                <select id="category-filter">
                    <option value="All">All Categories</option>
                    <!-- Categories will be populated by JavaScript -->
                </select>
            </div>

            <div class="icon-button-group">
                <button class="icon-button" id="center-graph" title="Center Graph">‚åñ</button>
                <button class="icon-button" id="reset-filters" title="Reset Filters">‚Üª</button>
                <button class="icon-button" id="toggle-labels" title="Toggle Labels">üè∑Ô∏è</button>
                <button class="icon-button" id="refresh-data" title="Refresh Data">üîÑ</button>
                <button class="theme-toggle" id="theme-toggle" title="Toggle Theme">
                    <span class="theme-toggle-icon">üåì</span>
                    <span class="theme-toggle-text">Toggle Theme</span>
                </button>
            </div>
        </div>

        <!-- Observations Panel -->
        <div class="observations-panel collapsed" id="observations-panel">
            <div class="observations-header">
                <h3>Node Details</h3>
                <div class="observations-close">√ó</div>
            </div>
            <div id="selected-node-info">
                <h2>Select a node to see details</h2>
            </div>
            <div class="observation-list" id="observation-list">
                <!-- Observations will be populated by JavaScript -->
            </div>
        </div>

        <!-- Observations toggle button -->
        <div class="observations-toggle" id="observations-toggle">
            <span>üëÅÔ∏è</span>
        </div>

        <!-- Search panel in top right -->
        <div id="search-panel" class="search-panel collapsed">
            <div class="search-header">
                <h3>Find Nodes</h3>
                <div class="search-close" title="Close Search">√ó</div>
            </div>
            <div class="search-input-container">
                <input type="text" id="node-search" placeholder="Type to search..." autocomplete="off">
            </div>
            <div id="search-results" class="search-results"></div>
        </div>
        <button id="search-toggle" class="search-toggle" title="Search Nodes">
            <span>üîç</span>
        </button>

        <!-- Controls help panel -->
        <div class="controls-help hidden" id="controls-help">
            <h3>Navigation Controls</h3>
            <div class="control-close">√ó</div>
            <div class="control-row">
                <div class="control-key">üñ±Ô∏è</div>
                <div class="control-description">Left click + drag to rotate</div>
            </div>
            <div class="control-row">
                <div class="control-key">üñ±Ô∏è</div>
                <div class="control-description">Right click + drag to pan</div>
            </div>
            <div class="control-row">
                <div class="control-key">‚öôÔ∏è</div>
                <div class="control-description">Scroll to zoom in/out</div>
            </div>
            <div class="control-row">
                <div class="control-key">Shift</div>
                <div class="control-description">Hold + drag for faster panning</div>
            </div>
            <div class="control-row">
                <div class="control-key">Ctrl</div>
                <div class="control-description">Hold + drag for precise rotation</div>
            </div>
            <div class="control-row">
                <div class="control-key">Alt</div>
                <div class="control-description">Hold + scroll for precise zooming</div>
            </div>
            <div class="control-row">
                <div class="control-key">2√óClick</div>
                <div class="control-description">Double-click to center on point</div>
            </div>
        </div>

        <!-- Controls help toggle button -->
        <div class="controls-help-toggle" id="controls-help-toggle">
            <span>?</span>
        </div>

        <!-- FPS display -->
        <div class="fps-display" id="fps-display">FPS: <span id="fps-counter">0</span></div>

        <div id="graph"></div>
        <div id="tooltip" class="tooltip"></div>

        <!-- Stats panel for performance monitoring -->
        <div class="stats-panel" id="stats-panel" style="display: none;">
            <div>Nodes: <span id="node-count">0</span></div>
            <div>Links: <span id="link-count">0</span></div>
            <div>FPS: <span id="fps">0</span></div>
        </div>
    </div>
    <script type="module" src="/scripts/main.js"></script>
</body>
</html>
